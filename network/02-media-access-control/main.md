# 개요

네트워크를 공부하면서 MAC에 대해 자세히 알고 싶어서 이 글을 작성합니다.

## 포스트 순서

1.  MAC에 대한 설명
2.  NIC 하드웨어
3.  L2 Frame 구조
4.  스위치 동작 방식
5.  MAC 계층별 차이(유선 MAC,무선 MAC)
6.  유선 프레임과 무선 프레임(유선 이더넷 프레임, 무선 802.11 프레임)
7.  활용 사례(DHCP, ARP, 가상화, Cloud)

---

## 1\. MAC에 대해서

MAC은 **두 가지 의미**를 가지고 있습니다:

1.  **MAC Protocol** (매체 접근 제어 프로토콜)
2.  **MAC Address** (매체 접근 제어 주소)

### 1.1 MAC 주소는 네트워크의 식별자 중 하나

네트워크에서 주요 식별자는 아래와 같습니다:

- **Port**: 프로세스(Process)의 식별자 (웹 개발 기준)
- **IP**: 호스트(Host)의 식별자
- **MAC Address**: 물리 주소의 식별자

### 1.2 MAC 주소의 구성 요소

MAC Address는 **매체 접근 제어 주소(Media Access Control Address)**의 약자이며, **네트워크 인터페이스(NIC)**에 할당된 고유 식별 주소입니다.

- **6 Octets (48비트)**로 구성되어 있으며, 두 개의 그룹으로 나뉩니다:
  - **OUI (Organizationally Unique Identifier)**: 제조사 식별 코드 (24비트)
  - **NIC Specific**: 네트워크 장치 고유 식별 값 (24비트)

#### 예시: `00:1A:2B:3C:4D:5E`

- **OUI**: `00:1A:2B` (제조사 정보)
- **NIC Specific**: `3C:4D:5E` (장치 고유 정보)

---

## 2\. NIC 하드웨어

NIC(Network Interface Controller)는 네트워크 데이터 처리를 담당하는 하드웨어 장치입니다. 주요 구성 요소는 다음과 같습니다:

- **PHY 칩**: 물리적 신호 처리
- **MAC 컨트롤러**: 프레임 생성 및 처리
- **버퍼 메모리**: 패킷 임시 저장
- **PCIe 인터페이스**: 시스템과 통신

### 2.1 데이터의 흐름

NIC에서 데이터가 처리되는 흐름은 다음과 같습니다:

1.  OS 커널은 IP 패킷에 **이더넷 헤더**를 추가해 L2 프레임을 생성합니다.
2.  생성된 L2 프레임이 NIC로 전달됩니다.
3.  OS는 **PCIe 버스**를 통해 프레임 데이터를 NIC의 버퍼 메모리로 전송하며, CPU 부하를 덜기 위해 **DMA 엔진**을 사용합니다.
4.  버퍼 메모리에서 **MAC 컨트롤러**가 프레임을 분석합니다.
5.  **CRC(Cyclic Redundancy Check)**를 통해 데이터 무결성을 확인한 후, **PHY 칩**이 데이터를 물리적 신호로 변환합니다.

---

## 3\. L2 Frame 구조

L2 프레임(이더넷 프레임)의 구조는 아래와 같습니다:

| **필드**                        | **크기(바이트)** | **설명**                            |
| ------------------------------- | ---------------- | ----------------------------------- |
| **프리앰블**                    | 7                | 수신 장치의 동기화 용도             |
| **SFD (Start Frame Delimiter)** | 1                | 프레임의 시작을 알리는 마커         |
| **목적지 MAC 주소**             | 6                | 수신 디바이스의 MAC 주소            |
| **출발지 MAC 주소**             | 6                | 송신 디바이스의 MAC 주소            |
| **이더타입**                    | 2                | 상위 계층의 프로토콜 식별           |
| **페이로드**                    | 46~1500          | 전송할 데이터 (IP 패킷 또는 ARP 등) |
| **CRC**                         | 4                | 데이터 무결성 검증                  |

---

## 4\. 스위치 동작 방식

스위치는 네트워크 데이터 프레임을 **MAC 주소**를 기반으로 전달합니다. 주요 동작 방식은 아래와 같습니다:

#### 4.1 MAC 주소 학습

- 스위치는 수신된 프레임의 **출발지 MAC 주소**와 포트를 기록하여 MAC 주소 테이블을 생성합니다.

#### 4.2 프레임 전달 방식

- 목적지 MAC 주소를 기반으로 **유니캐스트**, **브로드캐스트**, **플러딩** 중 적절한 방식으로 프레임을 전달합니다.

#### 4.3 브로드캐스트 및 멀티캐스트 처리

- 브로드캐스트 및 멀티캐스트 트래픽은 네트워크 전체로 전달됩니다.

#### 4.4 루프 방지

- **스패닝 트리 프로토콜(STP)** 또는 **RSTP**를 사용하여 네트워크 루프를 방지합니다.

---

## 5\. MAC 계층별 차이

### 5.1 유선 MAC

- **CSMA/CD**(Collision Detection)를 사용하여 충돌을 탐지하고 재전송 처리
- 신뢰성 높은 케이블 연결, 높은 속도 제공

### 5.2 무선 MAC

- **CSMA/CA**(Collision Avoidance)를 사용하여 충돌을 예방
- RTS/CTS(Request to Send / Clear to Send)로 숨겨진 노드 문제 해결

### 공통점

- MAC 계층에서 데이터는 **프레임 단위**로 전송됩니다.
- 데이터를 정확히 전달하기 위해 CRC를 활용합니다.

# 6\. 유선 프레임과 무선 프레임

위 L2 프레임은 유선과 무선으로 나뉘는데요.

각각에 대해서 살펴보겠습니다.

## 6.1 (유선) 이더넷 프레임 구조

유선 네트워크에서는 **이더넷 프레임** 구조를 사용합니다.

이더넷 프레임은 다음과 같은 필드들로 구성됩니다:

| **필드**            | **크기(바이트)** | **설명**                                                                  |
| ------------------- | ---------------- | ------------------------------------------------------------------------- |
| **프리앰블**        | 7                | 수신 장치의 신호 동기화에 사용됩니다.                                     |
| **SFD**             | 1                | 프레임의 시작을 알리는 마커                                               |
| **목적지 MAC 주소** | 6                | 프레임이 전달될 네트워크 장치의 MAC 주소                                  |
| **출발지 MAC 주소** | 6                | 프레임을 전송한 네트워크 장치의 MAC 주소                                  |
| **이더타입**        | 2                | 상위 계층 프로토콜(예: IPv4, ARP 등)을 식별                               |
| **페이로드**        | 46~1500          | 상위 계층 데이터 (IP 패킷, ARP 요청/응답 등). 46바이트보다 작을 경우 패딩 |
| **CRC**             | 4                | 데이터 무결성을 검증하기 위한 체크섬                                      |

## 6.2 (무선) 802.11 프레임

무선 네트워크에서는 **802.11 프레임** 구조가 사용됩니다.  
802.11 프레임은 이더넷 프레임보다 복잡하며, 다음과 같은 필드들로 구성됩니다:

| **필드**           | **크기(바이트)** | **설명**                                                       |
| ------------------ | ---------------- | -------------------------------------------------------------- |
| **프레임 제어**    | 2                | 프레임 타입, 서브타입, 관리 플래그 등을 포함                   |
| **기간/ID**        | 2                | 네트워크 예약 시간(혹은 식별자)을 나타냅니다.                  |
| **주소1 (목적지)** | 6                | 패킷이 전달될 최종 수신 장치의 MAC 주소                        |
| **주소2 (출발지)** | 6                | 패킷을 전송한 장치의 MAC 주소                                  |
| **주소3**          | 6                | 액세스 포인트(AP) 또는 라우터의 MAC 주소                       |
| **시퀀스 제어**    | 2                | 프레임의 순서 번호                                             |
| **주소4**          | 6 (선택적)       | WDS(Wireless Distribution System)에서만 사용되는 추가 MAC 주소 |
| **페이로드**       | 0~2304           | 전송할 데이터 (IP 패킷, ARP 요청/응답 등)                      |
| **FCS**            | 4                | 프레임 체크 시퀀스로 데이터 무결성을 검증                      |

### 6.2.1 무선 프레임의 특징

- **복잡한 주소 필드**: 무선 네트워크는 다양한 송신 및 수신 경로를 다루기 때문에 최대 4개의 주소 필드를 가질 수 있습니다.
- **관리 프레임**: 802.11은 관리, 제어, 데이터 전송의 세 가지 주요 프레임 타입을 지원합니다.
  - **관리 프레임**: 네트워크 연결 및 인증(Beacon, Probe, Authentication 등)
  - **제어 프레임**: 전송 흐름 제어 (RTS, CTS, ACK 등)
  - **데이터 프레임**: 실제 데이터를 포함
- **RTS/CTS**: 숨겨진 노드 문제를 해결하기 위해 전송 전에 RTS(Request to Send)와 CTS(Clear to Send) 메시지를 주고받습니다.
- **QoS 지원**: 802.11 프레임은 품질(QoS)을 보장하기 위한 필드도 포함할 수 있습니다.

### 6.2.2 유선 프레임과의 차이점

- **주소 필드 수**: 무선 802.11 프레임은 최대 4개의 주소 필드를 가질 수 있는 반면, 유선 이더넷 프레임은 출발지와 목적지 2개의 MAC 주소만 포함합니다.
- **무선 특화 필드**: 프레임 제어, 기간/ID, 추가 주소 필드 등이 무선 네트워크에서 사용됩니다.
- **환경적 영향**: 무선 프레임은 간섭, 장애물, 거리의 영향을 받기 쉽습니다.

---

#### 유선 vs 무선 프레임 요약 비교

| **특징**        | **유선 프레임 (Ethernet)** | **무선 프레임 (802.11)**           |
| --------------- | -------------------------- | ---------------------------------- |
| **주소 필드**   | 2개 (출발지, 목적지)       | 최대 4개 (출발지, 목적지, AP, WDS) |
| **충돌 처리**   | CSMA/CD                    | CSMA/CA (RTS/CTS로 회피)           |
| **프레임 구조** | 간단, 고정 크기            | 복잡, 동적으로 변화 가능           |
| **오류 처리**   | CRC                        | FCS                                |
| **특화 기능**   | 고속, 안정성               | 관리/제어 프레임, QoS 지원         |

## 7\. 활용 사례

지금까지 데이터 흐름 측면에서 살펴보았는데요.  
활용 측면에서 살펴보겠습니다.  
대표적으로 DHCP와 ARP, 가상화 환경, 클라우드 에서 설명할 수 있을 것 같습니다.

### 7.1 DHCP에서 MAC 주소의 역할

**DHCP (Dynamic Host Configuration Protocol)**는 네트워크 장치에 IP 주소를 자동으로 할당하는 프로토콜로, MAC 주소가 매우 중요한 역할을 합니다.

- **IP 주소 할당 과정**:
  1.  네트워크에 연결된 클라이언트는 **DHCP Discover** 메시지를 브로드캐스트로 전송하며, 메시지에 자신의 MAC 주소를 포함합니다.
  2.  DHCP 서버는 클라이언트의 MAC 주소를 기반으로 고유 IP 주소를 할당하고, **DHCP Offer** 메시지로 응답합니다.
  3.  클라이언트는 **DHCP Request** 메시지로 할당받은 IP 주소를 요청하며, 서버는 이를 확인 후 **DHCP Ack** 메시지로 확인합니다.
  4.  서버는 IP와 MAC 주소 간의 매핑 정보를 기록하여 관리합니다.
- **DHCP 예약**:
  - 네트워크 관리자는 특정 MAC 주소에 대해 고정 IP를 할당(예약)할 수 있습니다. 이는 프린터, 서버, VoIP 전화기와 같은 특정 장치의 관리에 유용합니다.

---

### 7.2 ARP와 MAC 주소

**ARP (Address Resolution Protocol)**는 IP 주소를 MAC 주소로 변환하는 프로토콜입니다. 네트워크 통신에서 필수적으로 사용됩니다.

- **ARP 동작 방식**:
  1.  장치가 특정 IP 주소로 데이터를 전송하려면 해당 IP 주소에 대한 MAC 주소가 필요합니다.
  2.  ARP 요청은 네트워크에 브로드캐스트로 전송되며, 이 요청은 "이 IP 주소를 사용하는 MAC 주소가 누구인가?"를 묻습니다.
  3.  대상 장치가 요청에 응답하여 자신의 MAC 주소를 포함한 **ARP 응답**을 전송합니다.
- **ARP 테이블**:
  - 네트워크 장치는 IP와 MAC 주소 매핑을 **ARP 캐시 테이블**에 저장하여 반복적인 ARP 요청을 줄이고 성능을 최적화합니다.
- **네트워크 트러블슈팅**:
  - ARP 테이블을 확인하면 네트워크 통신 오류를 진단할 수 있습니다. 예를 들어, 잘못된 MAC 주소가 매핑되었거나 ARP 스푸핑 공격이 발생했는지 확인할 수 있습니다.

---

### 7.3 가상화 환경에서의 MAC 주소 관리

가상화 기술에서는 물리적 네트워크 인터페이스를 여러 가상 머신(VM)이 공유합니다. MAC 주소는 각 VM을 구별하는 데 필수적입니다.

- **가상 MAC 주소 할당**:
  - 하이퍼바이저(예: VMware, KVM, Hyper-V)는 VM마다 고유한 MAC 주소를 동적으로 할당합니다.
  - MAC 주소는 물리 NIC와 가상 인터페이스 간의 매핑을 관리하는 데 사용됩니다.
- **MAC 주소 충돌 방지**:
  - MAC 주소 충돌은 네트워크 혼란을 초래할 수 있으므로, 하이퍼바이저는 미리 정의된 MAC 주소 범위에서 중복되지 않도록 관리합니다.
- **가상 스위치와 네트워크 통합**:
  - 가상 환경에서는 Open vSwitch와 같은 가상 스위치가 MAC 주소를 사용해 트래픽을 라우팅하거나 네트워크 세그먼트를 분리합니다.

---

### 7.4 클라우드 네트워킹과 MAC 주소

클라우드 환경에서는 동적인 네트워크 구성이 필요하며, MAC 주소는 데이터 전송 및 네트워크 관리를 지원하는 핵심 요소입니다.

- **클라우드 네트워크 격리**:
  - MAC 주소를 활용해 고객 간 네트워크를 분리하고, 각 가상 네트워크에 고유한 트래픽 경로를 설정합니다. (예: AWS VPC, Azure Virtual Network)
- **자동화된 MAC 관리**:
  - 클라우드 제공자는 MAC 주소를 자동으로 생성하고 관리합니다. 이는 대규모 네트워크를 효율적으로 운영하는 데 중요합니다.
- **네트워크 보안 강화**:
  - MAC 주소 필터링을 통해 비인가 장치의 네트워크 접근을 차단하거나, 특정 MAC 주소만 허용하는 정책을 설정할 수 있습니다.

---
