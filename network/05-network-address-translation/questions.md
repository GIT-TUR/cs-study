## NAT 질문

<details>
  <summary><h3>1. NAT가 어떻게 IPv4의 주소 부족 문제를 해결할까요?</h3></summary>
  NAT는 하나의 공인 IP 주소에 여러 사설 IP 주소를 매핑함으로써 IPv4 주소 부족 문제를 해결합니다. 내부에서는 공인 IP 주소가 아닌 사설 IP를 할당하고 외부와 통신할 때 하나의 공인 IP 주소를 공유하여 사용합니다. 이러한 방식으로 공인 IP 주소 부족 문제를 해결합니다.

  <br/> 
  
  <details>
    <summary>
      <strong>NAT의 동작 방식은 어떻게 될까요?</strong>
    </summary>
    <br/>
    NAT는 패킷이 내부에서 외부로 나갈 때 출발지 주소를 사설 IP에서 공인 IP로 변환하고 NAT 테이블에 이 정보를 기록합니다. 외부에서 응답이 오면 NAT 테이블에 기록했던 것을 확인해서 해당하는 사설 IP로 응답을 전달합니다.
      
  </details>
  <br/>
  <details>
    <summary>
      <strong>NAT 테이블에서 특정 연결에 대한 정보가 삭제되는 경우는 언제일까요?</strong>
    </summary>
    <br/>
    여러 상황에서 삭제될 수 있습니다. 대표적으로 TCP 연결에서 FIN, RST 패킷을 통해 연결이 종료된다면 삭제됩니다. 또한 설정된 타임아웃 기간 동안 해당 항목을 통한 통신이 없었다면 삭제되며, NAT 장비가 재시작되거나 메모리 부족 상황에서도 삭제됩니다.
    
  </details>
  <br/>
  <details>
    <summary>
      <strong>NAT에서 포트 충돌이 발생하게 되는 경우는 어떻게 처리할까요?</strong>
    </summary>
    <br/>
    가장 일반적으로는 포트 충돌을 막기 위해 포트 번호를 순차적으로 증가시켜 사용 가능한 포트를 찾습니다. 그런데 만약 모든 포트가 사용 중이라면 가장 오래된 연결을 종료하고 해당 포트를 재사용하거나 혹은 새로운 연결 요청 자체를 거부할 수도 있습니다.
    
  </details>
</details>

<br/>

<details>
  <summary><h3>2. NAT의 개념과 동작 원리를 설명하고, 사용되는 주요 목적에 대해 설명해주세요.</h3></summary>
  NAT는 사설 IP 주소를 공인 IP 주소로 변환해주는 기술입니다. IPv4 주소 부족 문제를 해결하고 내부 네트워크 보안을 강화해주는 역할을 합니다. 내부의 사설 IP를 사용하고 있는 곳에서 외부와 통신하기 위해서는 공인 IP로 변환해 전송을 하게 되고 이때 NAT 테이블이 전송을 한 사설 IP 주소를 기록해두었다가 해당 IP 주소가 요청했던 것에 대해 외부에서 응답이 오면 테이블을 참조해서 전달해주게 됩니다. 

  <br/> 
  
  <details>
    <summary>
      <strong>NAT을 사용하면 보안이 강화된다고 하는데, 어떤 방식으로 보안이 향상되나요?</strong>
    </summary>
    <br/>
    NAT는 내부 네트워크를 외부로부터 숨기는 역할을 합니다. 외부에서는 공인 IP 주소만 볼 수 있고 내부 네트워크나 구조나 사설 IP 주소를 직접적으로 알 수 없습니다. 외부로부터 직접적인 공격이 어려워지고 외부에서 내부로 직접적 연결이 기본적으로 차단되어 악의적 접근이 어렵습니다.
      
  </details>
  <br/>
  <details>
    <summary>
      <strong>IPv6에서는 NAT가 필요하지 않다고 하는데, 그 이유는 무엇인가요?</strong>
    </summary>
    <br/>
    IPv6의 주소는 128비트 주소로 지구상 모든 장치에 주소를 할당하고도 남는 충분한 양입니다. 그렇기 때문에 IPv4의 주소 부족 문제를 해결하기 위해 나온 NAT가 필요하지 않습니다. 모든 장치가 고유한 공인 IP 주소를 가질 수 있어 직접 통신이 가능합니다. (그러나 기존 인프라 호환성 문제로 IPv4 기반으로 구축된 인프라에서 한 번에 IPv6으로 바꾸는건 막대한 비용과 시간이 들며, IPv4의 해결책인 NAT가 잘 동작하므로 IPv6 도입에 대한 시급성을 못 느끼고 있습니다.)
    
  </details>
</details>

<br/>

<details>
  <summary><h3>3. NAT로 P2P 통신이 어려운 이유는 무엇인가요?</h3></summary>
  NAT의 기본 동작 방식은 내부 네트워크에서 사설 IP 주소를 할당 받고 외부로 통신할 때 공인 IP 주소를 공유해서 이를 통해 통신합니다. NAT에서는 내부 네트워크가 외부로 연결을 시작해야 NAT 테이블에 매핑 정보가 생성되는데, P2P 통신을 하려는데 양쪽 다 NAT 환경에 있다면 서로를 직접 찾을 수 없어서 통신이 어렵습니다.

  <br/> 
  
  <details>
    <summary>
      <strong>한쪽만 NAT 환경에 있다면 달라질까요?</strong>
    </summary>
    <br/>
    한쪽만 NAT 환경에 있다면 양쪽이 NAT 환경에 있을 때보다 상대적으로 더 수월하게 통신할 수 있습니다. NAT 환경이 아닌 쪽은 바로 접근이 가능하기 때문입니다. 그러나 NAT 환경에 있는 쪽으로 직접적 연결은 어렵습니다. 그래서 이 경우에는 NAT에 있는 호스트가 먼저 연결을 시작하면 NAT 테이블에 매핑 정보가 생성되어 양방향 연결이 가능해집니다.
      
  </details>
  <br/>
  <details>
    <summary>
      <strong>NAT 환경에서 P2P 통신은 어떻게 해결 가능할까요?</strong>
    </summary>
    <br/>
    STUN을 통해 클라이언트가 자신의 공인 IP 주소와 NAT 유형을 확인해서 P2P 연결을 시도할 수 있습니다. 그런데 방화벽과 같은 문제로 STUN을 통해서 직접적인 P2P 연결을 하지 못하는 경우에는 TURN 서버를 사용합니다. TURN 서버가 두 피어 간의 통신을 중계해주고, NAT를 우회하여 통신을 합니다. TURN 서버에 클라이언트는 패킷을 전달하고 서버가 다른 클라이언트로 전달해줍니다. 
    
  </details>
  <br/>
  <details>
    <summary>
      <strong>TURN 서버의 한계점은 무엇이 있을까요?</strong>
    </summary>
    <br/>
    모든 통신이 TURN 서버를 거치게 되므로, 직접 통신보다 지연이 발생합니다. 또한 서버의 대역폭을 사용하기 때문에 비용이 발생할 수 있습니다.
    
  </details>
</details>